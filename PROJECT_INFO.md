# 龟牌 - 项目开发信息

## 项目基本信息

- **项目名称**: 龟牌
- **引擎**: Godot 4.5
- **渲染管线**: Forward Plus
- **脚本语言**: GDScript
- **创建日期**: 2025-11-25
- **项目路径**: C:\Users\zyk\Documents\龟牌

## 项目结构

```
龟牌/
├── .godot/                 # Godot 引擎生成的缓存文件
├── project.godot           # 项目配置文件
├── icon.svg                # 项目图标
├── Card.gd                 # 卡牌数据结构类
├── Deck.gd                 # 牌组管理类
├── Player.gd               # 玩家基类
├── GameManager.gd          # 游戏核心控制器
├── UIController.gd         # UI控制器脚本
├── CardVisual.gd           # 卡牌视觉组件
├── Main.tscn               # 主游戏场景
├── GameTheme.tres          # 游戏主题资源
├── new_script.gd           # 脚本文件（待删除）
└── PROJECT_INFO.md         # 本文档
```

## 技术栈

- **游戏引擎**: Godot 4.5
- **编程语言**: GDScript
- **渲染**: Vulkan (Forward Plus)

## 当前开发状态

### 已完成
- [x] 项目初始化
- [x] 基础脚本模板创建
- [x] Card.gd - 卡牌数据结构
- [x] Deck.gd - 洗牌和发牌逻辑
- [x] Player.gd - 玩家基类（包含AI逻辑）
- [x] GameManager.gd - 核心游戏控制器和状态机
- [x] Main.tscn - 主游戏场景
- [x] UIController.gd - UI控制器（信号连接）
- [x] CardVisual.gd - 卡牌视觉组件
- [x] GameTheme.tres - 游戏主题样式
- [x] 所有游戏信号连接到UI
- [x] 动画系统（Tween动画）
- [x] 视觉反馈效果

### 进行中
- [ ] 游戏测试和平衡调整

### 待开发
- [ ] 音效和音乐
- [ ] 更多粒子效果
- [ ] 性能优化
- [ ] 移动端适配（可选）

## 游戏设计

### 游戏类型
**卡牌游戏 - "Bullshit" (也称为 Cheat / I Doubt It)**

### 核心玩法

#### 基本规则
- **牌组**: 标准52张扑克牌（无Joker）
- **玩家**: 4名玩家（1名人类，3名AI）
- **回合制**: 顺时针进行

#### 游戏循环
1. **目标等级**: 游戏按顺序循环等级 A → 2 → 3 ... → K → A ...
2. **出牌**: 玩家必须从手牌中选择1-4张牌，面朝下放入弃牌堆，并声明"我打出[数量]张[目标等级]"
3. **虚张声势**: 打出的牌不必与声明的目标等级匹配（可以说谎）
4. **质疑阶段**: 玩家出牌后，有3秒的时间窗口，其他玩家可以"质疑"（叫"Bullshit"）
5. **结算**:
   - **如果被质疑**: 翻开打出的牌
	 - **虚张声势被发现**（牌≠目标等级）: 出牌者拿走整个弃牌堆
	 - **错误指控**（牌=目标等级）: 质疑者拿走整个弃牌堆
   - **如果未被质疑**: 牌保持面朝下，轮次传递给下一位玩家，目标等级递增
6. **胜利条件**: 最先清空手牌的玩家获胜

### AI逻辑

#### 出牌策略
- 如果AI持有目标等级的牌，有90%几率打出真牌
- 如果没有目标等级的牌，选择最低价值的垃圾牌虚张声势

#### 质疑策略
- **必定质疑**: 如果AI持有3张目标等级的牌，而当前玩家声称打出2张，AI知道这不可能（3+2>4），必定质疑
- **概率质疑**: 根据打出的牌数计算概率
  - 声称3+张: 30%几率质疑
  - 声称2张: 15%几率质疑
  - 声称1张: 5%几率质疑
- **弃牌堆因素**: 如果弃牌堆超过20张，质疑概率减半（风险太高）

### 美术风格
_待设计_（建议：简洁的卡牌UI，清晰的文字提示）

## 资源列表

### 核心脚本文件
- `Card.gd` - 卡牌资源类
  - 枚举：花色（Suit）和等级（Rank）
  - 方法：获取牌名、花色符号、字符串表示
- `Deck.gd` - 牌组管理类
  - 初始化52张标准扑克牌
  - 洗牌和发牌功能
  - 信号：deck_shuffled, cards_dealt
- `Player.gd` - 玩家基类
  - 支持人类和AI两种类型
  - 手牌管理：接收、排序、打出
  - AI决策：decide_play(), should_challenge()
  - 信号：cards_played, challenge_initiated, hand_updated
- `GameManager.gd` - 游戏核心控制器
  - 状态机：SETUP, PLAYER_TURN, AI_TURN, CHALLENGE_WINDOW, RESOLUTION, GAME_OVER
  - 游戏流程控制
  - 质疑系统（3秒倒计时）
  - 信号系统：解耦UI和逻辑

### UI脚本文件
- `UIController.gd` - UI主控制器
  - 连接所有GameManager信号到UI元素
  - 管理玩家手牌显示
  - 处理玩家输入（选卡、出牌、质疑）
  - 动画效果：脉冲、抖动、闪烁、弹跳、淡入
  - 实时更新游戏状态显示
- `CardVisual.gd` - 卡牌可视化组件
  - 显示卡牌等级和花色
  - 卡牌选择动画
  - 悬停效果
  - 颜色区分（红心/方块 vs 黑桃/梅花）

### 场景文件
- `Main.tscn` - 主游戏场景
  - 包含完整UI布局
  - 顶部栏：当前等级、游戏状态
  - 中部区域：AI玩家信息、弃牌堆、质疑按钮
  - 底部区域：玩家手牌、出牌按钮
  - 游戏结束面板

### 资源文件
- `GameTheme.tres` - 游戏主题
  - 自定义Panel样式
  - 自定义Button样式（正常/悬停/按下）
  - 圆角和边框效果
- 音效文件 _待添加_

## 开发日志

### 2025-11-25

#### 第一阶段：核心逻辑开发
- 项目创建
- 初始化 Godot 4.5 项目
- 创建项目信息文档
- **核心逻辑开发完成**:
  - 实现 Card.gd - 完整的卡牌数据结构
  - 实现 Deck.gd - 52张牌的生成、洗牌、发牌
  - 实现 Player.gd - 玩家/AI基类，包含完整的AI决策逻辑
  - 实现 GameManager.gd - 完整的游戏状态机和规则系统

#### 第二阶段：UI系统开发
- **UI场景和控制器**:
  - 创建 Main.tscn - 完整的游戏场景布局
  - 实现 UIController.gd - UI主控制器
  - 实现 CardVisual.gd - 卡牌可视化组件
  - 创建 GameTheme.tres - 游戏主题样式
- **信号系统集成**:
  - 连接所有9个GameManager信号到UI
  - 连接Player手牌更新信号
  - 实现完整的事件驱动UI更新
- **动画和视觉反馈**:
  - 状态标签脉冲动画（回合切换）
  - 质疑按钮闪烁和抖动
  - 弃牌堆更新弹跳动画
  - 游戏结束面板淡入效果
  - 卡牌选择动画
  - 颜色编码的消息提示
- **完整功能实现**:
  - 玩家手牌可视化和交互
  - 卡牌选择系统（最多4张）
  - 出牌功能
  - 质疑功能（3秒倒计时）
  - AI玩家信息显示
  - 游戏结束和重新开始

**游戏已完全可玩！**

## 待办事项

1. [x] 确定游戏类型和核心玩法
2. [x] 设计游戏架构
3. [x] 实现核心游戏逻辑
4. [x] 实现AI决策系统
5. [x] 创建主游戏场景
6. [x] 设计和实现UI系统
7. [x] 连接信号到UI元素
8. [x] 添加视觉反馈和动画
9. [ ] 游戏测试和平衡调整
10. [ ] 添加音效和背景音乐
11. [ ] 性能优化和打包

## 开发笔记

### 技术要点
- **Godot 4.5**: 使用新的渲染架构
- **GDScript 2.0**: 支持类型注解，所有代码都使用强类型
- **节点组合模式**: 使用节点系统构建游戏对象
- **信号驱动架构**: 使用Godot信号系统解耦游戏逻辑和UI
- **状态机模式**: GameManager使用明确的状态机控制游戏流程
- **资源系统**: Card类继承自Resource，可序列化

### 架构设计
- **Card.gd**: 纯数据类，继承Resource
- **Deck.gd**: 继承Node，管理牌组
- **Player.gd**: 继承Node，封装玩家数据和AI逻辑
- **GameManager.gd**: 核心控制器，协调所有游戏对象

### 信号系统
GameManager提供以下信号供UI订阅（已全部连接）：
- `game_state_changed` - 游戏状态变更 ✓
- `turn_changed` - 回合切换 ✓
- `target_rank_changed` - 目标等级更新 ✓
- `cards_played_to_pile` - 卡牌被打出 ✓
- `challenge_window_started` - 质疑窗口开始 ✓
- `challenge_window_ended` - 质疑窗口结束 ✓
- `challenge_made` - 质疑发起 ✓
- `challenge_resolved` - 质疑结算 ✓
- `pile_updated` - 弃牌堆更新 ✓
- `game_won` - 游戏结束 ✓

### 动画效果系统
使用Godot Tween实现以下动画：
- **脉冲动画** (animate_label_pulse)：标签放大缩小，用于状态切换
- **抖动动画** (animate_label_shake)：快速左右抖动，用于提示
- **闪烁动画** (animate_button_flash)：按钮颜色循环，用于质疑按钮
- **弹跳动画** (animate_label_scale_bounce)：弹性缩放，用于弃牌堆更新
- **淡入动画** (animate_panel_fade_in)：面板透明度渐变，用于游戏结束

### AI实现细节
- **出牌**: 优先打真牌（90%），否则打最小的牌虚张声势
- **质疑**: 基于逻辑推理（不可能情况）和概率计算
- **随机延迟**: AI行动有0.5-2秒随机延迟，模拟思考时间

### 性能考虑
- 牌组只在游戏开始时生成一次
- 手牌自动排序，便于玩家查看
- 使用Array[Card]强类型数组，提高性能

### 已知问题
_暂无_

## 参考资源

- [Godot 官方文档](https://docs.godotengine.org/)
- [GDScript 风格指南](https://docs.godotengine.org/en/stable/tutorials/scripting/gdscript/gdscript_styleguide.html)

---

**最后更新**: 2025-11-25 (UI系统和动画开发完成 - 游戏可玩)
