# 鬼牌游戏 - 离线模式说明

## 什么是离线模式？

离线模式是游戏在 **检测不到 Steam** 时自动启用的单人游戏模式。

### 离线模式的特点

✅ **自动激活** - Steam 不可用时自动切换
✅ **无需网络** - 完全本地运行
✅ **单人游戏** - 适合测试和练习
✅ **完整功能** - 支持所有游戏核心玩法

## 如何触发离线模式？

离线模式会在以下情况自动启动：

1. **Steam 客户端未运行**
2. **Steam API 初始化失败**
3. **GodotSteam 插件未安装**
4. **网络不可用**

## 离线模式界面

### 主菜单

当游戏进入离线模式时，你会看到：

```
状态显示: "离线模式 - 离线玩家XXX"
```

#### 可用功能
- ✅ **创建房间** - 创建本地单人游戏
- ❌ **加入房间** - 禁用（离线无法联机）
- ❌ **输入房间码** - 禁用

### 房间大厅

离线模式的房间大厅显示：

```
房间码: XXXXX [离线模式]
状态: 离线单人游戏
```

#### 游戏流程
1. 点击 "创建房间"
2. 进入大厅，显示离线模式标识
3. 点击 "开始游戏"
4. 开始单人游戏

## 离线模式 vs 在线模式

| 功能 | 离线模式 | 在线模式 |
|------|---------|---------|
| Steam 登录 | ❌ | ✅ |
| 创建房间 | ✅ | ✅ |
| 加入房间 | ❌ | ✅ |
| 多人联机 | ❌ | ✅ |
| 单人游戏 | ✅ | ✅ |
| 好友邀请 | ❌ | ✅ |
| 成就系统 | ❌ | ✅ |

## 离线模式的技术实现

### 自动检测
```gdscript
# SteamManager.gd
func initialize_steam() -> void:
    var init_result: Dictionary = Steam.steamInitEx()

    if init_result['status'] != 1:
        # Steam 不可用，切换到离线模式
        is_offline_mode = true
        steam_id = randi() % 1000000
        player_name = "离线玩家" + str(steam_id % 1000)
```

### 跳过网络通信
```gdscript
# NetworkManager.gd
func send_message_to(peer_id: int, message: Dictionary) -> void:
    if SteamManager.is_offline_mode:
        return  # 离线模式不发送网络消息
```

### 本地房间
```gdscript
# SteamManager.gd
func _create_offline_lobby(max_players: int) -> void:
    current_lobby_id = randi() % 100000
    lobby_members.append({
        "steam_id": steam_id,
        "name": player_name
    })
```

## 常见问题

### Q1: 如何退出离线模式？
**A**: 关闭游戏，启动 Steam 客户端，然后重新运行游戏。

### Q2: 离线模式能保存游戏进度吗？
**A**: 当前版本不支持进度保存，每次都是新游戏。

### Q3: 离线模式能和AI玩吗？
**A**: 当前版本离线模式是单人游戏，暂不支持AI对手。

### Q4: 为什么离线模式不能加入房间？
**A**: 离线模式没有网络连接，无法连接到其他玩家的房间。

### Q5: 离线模式的玩家名称是什么？
**A**: 自动生成的名称，格式为"离线玩家XXX"，XXX 是随机数字。

## 开发者信息

### 离线模式的代码修改

**修改的文件**：
1. `Scripts/Autoload/SteamManager.gd` - 添加离线模式检测和本地房间
2. `Scripts/Autoload/NetworkManager.gd` - 跳过 P2P 网络通信
3. `Scripts/UI/MainMenu.gd` - 显示离线模式UI
4. `Scripts/UI/Lobby.gd` - 显示离线模式标识

**新增变量**：
- `SteamManager.is_offline_mode: bool` - 离线模式标志

**修改的函数**：
- `SteamManager.initialize_steam()` - 添加离线模式初始化
- `SteamManager.create_lobby()` - 支持创建本地房间
- `NetworkManager._ready()` - 跳过 Steam 信号连接
- `NetworkManager.send_message_*()` - 跳过网络发送

## 未来计划

可能的离线模式增强：

- [ ] AI 对手
- [ ] 本地多人游戏（热座模式）
- [ ] 游戏进度保存
- [ ] 单人挑战模式
- [ ] 难度设置

---

**明日之歌工作室**
开发人员：周義坤、孙钰章
